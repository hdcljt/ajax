class e extends Error{constructor(e,t,n,r){super(e),this.name="XHRError",this.reason=t,this.request=n,this.response=r}get isCancel(){return 1===this.reason}}function t(e,t,n){o(n)?u(e)?t(e):n(e):t(e)}function n(e,t){return t?(a(t)||(t=[t]),t.filter(o).reduce((t,n)=>n(e),e)):e}const r=e=>void 0===e,o=e=>"function"==typeof e,s=e=>"string"==typeof e,a=Array.isArray,i=e=>null!==e&&"object"==typeof e,u=t=>t instanceof e;function c(e,t={}){return Object.keys(t).filter(e=>t[e]&&s(t[e])).reduce((e,n)=>(e[n]=t[n],e),e)}function l(e,t){let n=c({},e.common);return n=c(n,e[t]),n=c(n,e),function(e,t){return Object.entries(e).reduce((e,n)=>{let r=n[0];return r=t&&t.toUpperCase()===r.toUpperCase()?t:r.replace(/\b(\w)/g,e=>e.toUpperCase()),e[r]=n[1],e},{})}(n,"Content-Type")}function p(e,t="application/x-www-form-urlencoded;charset=utf-8",n="reserve"){return e["Content-Type"]?"override"===n&&(t?e["Content-Type"]=t:delete e["Content-Type"]):t&&(e["Content-Type"]=t),e}function d(e){if(!e)return{};const t={};return e.split("\n").forEach(e=>{const n=e.match(/([^\s]*)\s*:\s*([^\s].*[^\s]|[^\s])(?=\s*$)/);if(!n)return;let[,r,o]=n;t[r]=t[r]?[].concat(t[r],o):o}),t}function f(e,t="brackets"){const n=[];return function e(s,u=""){Object.keys(s).filter(e=>{return t=s[e],!(o(t)||r(t)||null===t||"symbol"==typeof t||"number"==typeof t&&!isFinite(t));var t}).forEach(r=>{let o=s[r];r=function(e,t,n,r){return t?n?`${t}${"none"===r?"":"brackets"===r?"[]":`[${e}]`}`:`${t}[${e}]`:e}(r,u,a(s),t),o instanceof Date&&(o=o.toISOString()),i(o)?e(o,r):n.push(`${y(r)}=${y(o)}`)})}(e),n.join("&")}function y(e){return encodeURIComponent(e).replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}const h={url:"",method:"get",params:"",query:"",body:null,baseURL:"",headers:{common:{Accept:"application/json, text/plain, */*"}},timeout:0,responseType:"",withCredentials:!1,signal:"",transformQuery:e=>e?s(e)?e:f(e):"",transformBody:(e,t)=>!e||e instanceof FormData||e instanceof Blob||e instanceof URLSearchParams||e instanceof ArrayBuffer||ArrayBuffer.isView(e)?(p(t,"","override"),e||null):i(e)?t["Content-Type"]&&t["Content-Type"].includes("application/x-www-form-urlencoded")?f(e):(p(t,"application/json;charset=utf-8"),JSON.stringify(e)):e,transformResponse:e=>{if("string"==typeof e)try{e=JSON.parse(e)}catch{}return e},validateStatus:e=>e>=200&&e<300,onUploadProgress:null,onDownloadProgress:null},m={request:void 0,response:void 0,error:void 0};const g=new Map;function b(e){g.forEach((t,n)=>{if(e){if(n.split("[")[0]!==e)return}t.abort()})}const w=e=>Object.keys(e).reduce((t,n)=>{const r=e[n];return s(r)&&(t[n]=r),t},{}),T=e=>(!e||s(e)||e instanceof FormData||e instanceof Blob||e instanceof URLSearchParams||e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&e||null;function C({url:n,method:r=h.method,body:s=T(h.body),headers:a=w(h.headers),timeout:i=h.timeout,responseType:u=h.responseType,withCredentials:c=h.withCredentials,validateStatus:l=h.validateStatus,onUploadProgress:p=h.onUploadProgress,onDownloadProgress:f=h.onDownloadProgress,signal:y=h.signal}){return new Promise((h,m)=>{const b=r.toUpperCase(),w=`${y}[${b}](${n})`,T=function(e){return g.has(e)||g.set(e,new XMLHttpRequest),g.get(e)}(w);T.open(b,n),T.onload=()=>t(function(t,n){let r;r=""!==t.responseType&&"text"!==t.responseType||!t.responseText?"document"===t.responseType&&t.responseXML?t.responseXML:t.response:t.responseText;const o={data:r,headers:d(t.getAllResponseHeaders()),status:t.status,statusText:t.statusText,request:t};return n(t.status)?o:new e("响应异常",0,t,o)}(T,l),m,h),T.onabort=()=>t(function(t){return new e("请求被中止",1,t)}(T),m),T.onerror=()=>t(function(t){return new e("请求异常，online:"+navigator.onLine,2,t)}(T),m),T.ontimeout=()=>t(function(t){return new e("超时，timeout:"+t.timeout,3,t)}(T),m),T.onloadend=()=>function(e){g.delete(e)}(w),o(f)&&(T.onprogress=f),o(p)&&(T.upload.onprogress=p),function(e,t,n,r,o){Object.keys(t).filter(e=>!!t[e]).forEach(n=>e.setRequestHeader(n,t[n])),e.responseType=n,e.timeout=1e3*r,e.withCredentials=o}(T,a,u,i,c),T.send(s||null)})}export default function(e){const t=function e(t,n){return Object.keys(n).reduce((t,o)=>{const s=n[o];return i(s)&&i(t[o])?t[o]=e(t[o],s):r(t[o])&&(t[o]=s),t},t)}(e=n(e=s(e)?{url:e}:e,m.request),h);if(t.headers=l(t.headers,t.method),["get","head","options","delete"].includes(t.method)){"delete"!==t.method&&(t.body=null,p(t.headers,"","override"));const e=t.transformQuery(t.query,t.headers);s(e)?t.query=e:(t.query=e[0],e[1]&&(t.headers=e[1]))}if(["post","put","patch","delete"].includes(t.method)){"delete"!==t.method&&(t.query="");const e=t.transformBody(t.body,t.headers);a(e)?(t.body=e[0],e[1]&&(t.headers=e[1])):t.body=e}var o,u,c,d;return t.url=(o=t.url,u=t.baseURL,c=t.params,d=t.query+"",function(e){return/^(?:[a-z][a-z\d+.\-]*:)?\/\//i.test(e)}(o)&&(u=""),function(e,t,n,r){return e&&(t=e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,"")),n&&!t.includes("?")&&(t=t.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,"")),r&&(t=t.replace(/\/+$/,"")+(t.includes("?")?"&":"?")+r),t=t.replace(/#.*$/,"")}(u,o,c,d)),C(t).then(e=>(e.data=t.transformResponse(e.data),e.config=t,e=n(e,m.response)),e=>(e.config=t,e=n(e,m.error),Promise.reject(e)))}export{b as cancel,h as defaults,m as interceptor,C as request,f as stringify};
